(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var r=function(){function t(i,s){e(this,t),i=window.innerWidth,s=window.innerHeight,this.reductionRatio=NaN,this.reductionRatio=i<s?i:s,this.w=this.reductionRatio/10,this.h=this.reductionRatio/9,this.x=i/2-s/10/2,this.y=s-4*this.h/3,this.speed=8,this.score=0,this.health=3,this.healthW=50,this.explMusic=new Audio("assets\\audio\\explosion1.mp3"),this.playerIm=new Image,this.shipExpIm=new Image,this.healthIm=new Image,this.shipExpIm_sprite=new Image,this.explLife=14,this.currentExplLife=this.explLife,this.explWidth=112,this.explX,this.lazerReloadDistance=this.y-120,this.lazerLoaded=!0,this.lazers=[],this.init()}return i(t,[{key:"init",value:function(){this.playerIm.src="assets\\images\\ship1.webp",this.shipExpIm.src="assets\\images\\explShip.webp",this.healthIm.src="assets\\images\\life.webp",this.shipExpIm_sprite.src="assets\\images\\spriteMap_2.webp"}},{key:"resize",value:function(){this.reductionRatio=u<p?u:p,this.w=this.reductionRatio/10,this.h=this.reductionRatio/9,this.x=u/2-p/5,this.y=p-4*this.h/3}},{key:"reset",value:function(){this.x=u/2-p/10/2,this.y=p-p/9-15,this.w=p/10,this.h=p/9,this.currentExplLife=14,this.score=0,this.health=3,this.lazers=[]}},{key:"drawSprite",value:function(e){if(this.currentExplLife===this.explLife)e.drawImage(this.playerIm,this.x,this.y,this.w,this.h);else{var t=this.explLife-this.currentExplLife;t<=4&&e.drawImage(this.shipExpIm,this.x,this.y,this.w,this.h),e.drawImage(this.shipExpIm_sprite,this.explWidth*t,0,this.explWidth,this.shipExpIm_sprite.height,this.x-this.w/2,this.y-4*this.h/3,2*this.w,2*this.h),this.currentExplLife--,0===this.currentExplLife&&(this.currentExplLife=this.explLife)}}},{key:"drawScore",value:function(e){e.fillStyle="#3b95d4",e.shadowColor="#3b95d4",e.shadowBlur=15,e.font="regular 28px Comic Sans MS cursive",e.textAlign="right",e.fillText(this.score,u-50,35),e.shadowBlur=0}},{key:"drawHealth",value:function(e){for(var t=10+this.healthW,i=0;i<this.health;i++)e.drawImage(this.healthIm,10+t*i,10,this.healthW,40)}},{key:"drawLasers",value:function(e){0!==this.lazers.length?this.lazers[this.lazers.length-1].y>=this.lazerReloadDistance&&(this.lazerLoaded=!0):this.lazerLoaded=!0;for(var t=0;t<this.lazers.length;t++){var i=this.lazers[t];i.y>-20?i.drawOneLazer(e):this.lazers.splice(t,1)}}}]),t}(),a=function(){function t(i){e(this,t),this.x=i.x+i.w/2,this.y=i.y,this.lazerSpeed=16}return i(t,[{key:"drawOneLazer",value:function(e){e.fillStyle="#ff9500",e.shadowColor="#ff9500",this.y-=this.lazerSpeed,e.fillRect(this.x,this.y,2,18),e.shadowBlur=0}}]),t}(),h=function(){function t(){e(this,t),this.reductionRatio=0,this.reductionRatio=u<p?u:p,this.alive=!0,this.speed=5*Math.random()+3,this.x=Math.floor(Math.random()*u-p/10),this.y=0-p/10,this.h=this.reductionRatio/10,this.w=this.reductionRatio/10,this.explLife=6,this.explX=0,this.explWidth=194}return i(t,[{key:"drawSprite",value:function(e,t){e.drawImage(t,this.x,this.y,this.w,this.h)}},{key:"move",value:function(){this.y+=this.speed}},{key:"drawExplosion",value:function(e,t){e.drawImage(t,this.explX,0,this.explWidth,t.height,this.x,this.y,this.w,this.h),this.explX+=this.explWidth}},{key:"resize",value:function(){this.reductionRatio=u<p?u:p,this.h=this.reductionRatio/10,this.w=this.reductionRatio/10}}]),t}(),n=function(){function t(i,s){e(this,t),this.asteroids=[],this.explAsteroids=[],this.asteroidIm=new Image,this.explIm=new Image,this.maxAsteroids=20,this.collidedAIndex=-1,this.player=new r(i,s),this.explMusic=new Audio("assets\\audio\\explosion2.mp3"),this.init()}return i(t,[{key:"init",value:function(){this.asteroidIm.src="assets\\images\\asteroid.webp",this.explIm.src="assets\\images\\spriteMapExpl.webp"}},{key:"reset",value:function(){this.asteroids=[],this.player.reset()}},{key:"drawAsteroids",value:function(e){Math.random()<=.099&&this.asteroids.length<this.maxAsteroids&&this.asteroids.push(new h);for(var t=0;t<this.asteroids.length;t++){var i=this.asteroids[t];!1!==i.alive?i.y>p+i.h?this.asteroids.splice(t,1):(i.drawSprite(e,this.asteroidIm),i.move()):(this.explAsteroids.push(i),this.asteroids.splice(t,1))}for(var s=0;s<this.explAsteroids.length;s++){var r=this.explAsteroids[s];r.explLife<=0?this.explAsteroids.splice(s,1):r.explLife>0&&(r.drawExplosion(e,this.explIm),r.explLife--)}}},{key:"resize",value:function(){this.player.resize();var e,t=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,n=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,h=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw h}}}}(this.asteroids);try{for(t.s();!(e=t.n()).done;)e.value.resize()}catch(e){t.e(e)}finally{t.f()}}},{key:"checkCollision",value:function(e){for(var t=0;t<this.asteroids.length;t++){var i=this.asteroids[t];this.player.currentExplLife===this.player.explLife?(i.x-i.w/4*3<=this.player.x&&i.x+i.w/4*3>=this.player.x&&i.y+i.h/3>=this.player.y&&this.collidedAIndex!==this.asteroids.indexOf(i)&&(this.collidedAIndex=this.asteroids.indexOf(i),this.player.health--,this.player.currentExplLife--),this.collidedAIndex===this.asteroids.indexOf(i)&&i.y<p/2&&(this.collidedAIndex=-1)):this.player.explMusic.play();for(var s=0;s<this.player.lazers.length;s++){var r=this.player.lazers[s];r.x<=i.x+i.w&&r.x>=i.x&&r.y<=i.y&&(i.alive=!1,this.explMusic.stop(),this.explMusic.play(),this.player.score++,this.player.lazers.splice(this.player.lazers.indexOf(r),1))}}}}]),t}(),o=function(){function t(i,s){e(this,t),this.playText="",this.bgIm=new Image,this.gameStatus="start",this.backgroundHeight=0,this.bgSpeed=2,this.init()}return i(t,[{key:"init",value:function(){this.bgIm.src="assets\\images\\space.webp"}},{key:"showText",value:function(e){l.width=window.innerWidth,l.height=window.innerHeight,e.clearRect(0,0,u,p),e.fillStyle="#cb6e06",e.shadowColor="#392388",e.shadowBlur=25,e.textBaseline="middle","start"===this.gameStatus?this.playText="Click to start":"finish"===this.gameStatus&&(e.font="90px Comic Sans MS cursive",e.fillText("your score: "+c.player.score,u/2-e.measureText(this.playText).width/2,p/2+120),this.playText="GAME OVER"),e.font="regular 120px Comic Sans MS cursive",e.fillText(this.playText,u/2-e.measureText(this.playText).width/2,p/2),e.shadowBlur=0}},{key:"drawBackground",value:function(e){this.backgroundHeight+this.bgSpeed<p?this.backgroundHeight+=this.bgSpeed:this.backgroundHeight=0;for(var t=0,i=this.backgroundHeight;t<u;){for(;i<p;)e.drawImage(this.bgIm,t,i),i+=this.bgIm.height;t+=this.bgIm.width,i=this.backgroundHeight}for(t=0,i=this.backgroundHeight-p-this.bgIm.height;t<u;){for(;i<this.backgroundHeight;)e.drawImage(this.bgIm,t,i),i+=this.bgIm.height;t+=this.bgIm.width,i=this.backgroundHeight-p-this.bgIm.height}}},{key:"gamePlay",value:function(e,t){this.drawBackground(e),t.checkCollision(e),t.drawAsteroids(e),t.player.drawLasers(e),t.player.drawSprite(e),t.player.drawScore(e),t.player.drawHealth(e),t.player.health<=0&&t.player.explLife===t.player.currentExplLife&&(this.gameStatus="finish")}}]),t}(),l=document.querySelector(".canvas");l.style.touchAction="manipulation",l.style.backgroundImage="url('assets/images/space.webp')";var d=l.getContext("2d"),u=window.innerWidth,p=window.innerHeight,c=new n(u,p),f=new o(u,p);function y(){switch(f.gameStatus){case"start":f.showText(d),c.reset(),c.resize();break;case"play":f.gamePlay(d,c);break;case"finish":f.showText(d)}window.requestAnimationFrame(y)}function w(e){switch(f.gameStatus){case"start":f.gameStatus="play";break;case"play":"right"===e&&c.player.x<=u-c.player.w?c.player.x+=c.player.speed:"left"===e&&c.player.x>0?c.player.x-=c.player.speed:!c.player.lazerLoaded||"click"!==e&&"space"!==e||(c.player.lazers.push(new a(c.player)),c.player.lazerLoaded);break;case"finish":f.gameStatus="start"}}HTMLAudioElement.prototype.stop=function(){this.pause(),this.currentTime=0},window.onload=function(){l.width=window.innerWidth,l.height=window.innerHeight,y()},window.addEventListener("resize",(function(e){l.width=e.target.innerWidth,l.height=e.target.innerHeight,u=e.target.innerWidth,p=e.target.innerHeight,c.resize()})),document.addEventListener("keydown",(function(e){"ArrowRight"===e.key?w("right"):"ArrowLeft"===e.key&&w("left")}),!0),document.addEventListener("keyup",(function(e){" "===e.key&&w("space")}),!0),l.onmousemove=function(e){c.player.x=e.clientX-c.player.w/2},l.onmousedown=function(e){w("click")},l.addEventListener("touchstart",(function(e){e.stopPropagation(),e.preventDefault(),w("click")})),l.addEventListener("touchmove",(function(e){if(e.stopPropagation(),e.preventDefault(),1===e.targetTouches.length){var t=e.targetTouches[0];c.player.x=t.pageX-c.player.w/2}}))})();
