(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function i(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var r=function(){function e(i,s){t(this,e),i=window.innerWidth,s=window.innerHeight,this.reductionRatio=NaN,this.reductionRatio=i<s?i:s,this.w=this.reductionRatio/10,this.h=this.reductionRatio/9,this.x=i/2-s/10/2,this.y=s-4*this.h/3,this.speed=8,this.score=0,this.health=3,this.healthW=50,this.explMusic=new Audio("assets\\audio\\explosion1.mp3"),this.playerIm=new Image,this.shipExpIm=new Image,this.healthIm=new Image,this.shipExpIm_sprite=new Image,this.explLife=14,this.currentExplLife=this.explLife,this.explWidth=112,this.explX,this.lazerReloadDistance=this.y-120,this.lazerLoaded=!0,this.lazers=[],this.init()}return i(e,[{key:"init",value:function(){this.playerIm.src="assets\\images\\ship1.webp",this.shipExpIm.src="assets\\images\\explShip.webp",this.healthIm.src="assets\\images\\life.webp",this.shipExpIm_sprite.src="assets\\images\\spriteMap_2.webp"}},{key:"resize",value:function(){this.reductionRatio=p<u?p:u,this.w=this.reductionRatio/10,this.h=this.reductionRatio/9,this.x=p/2-u/5,this.y=u-4*this.h/3}},{key:"reset",value:function(){this.x=p/2-u/10/2,this.y=u-u/9-15,this.w=u/10,this.h=u/9,this.currentExplLife=14,this.score=0,this.health=3,this.lazers=[]}},{key:"drawSprite",value:function(t){if(this.currentExplLife===this.explLife)t.drawImage(this.playerIm,this.x,this.y,this.w,this.h);else{var e=this.explLife-this.currentExplLife;e<=4&&t.drawImage(this.shipExpIm,this.x,this.y,this.w,this.h),t.drawImage(this.shipExpIm_sprite,this.explWidth*e,0,this.explWidth,this.shipExpIm_sprite.height,this.x-this.w/2,this.y-4*this.h/3,2*this.w,2*this.h),this.currentExplLife--,0===this.currentExplLife&&(this.currentExplLife=this.explLife)}}},{key:"drawScore",value:function(t){t.fillStyle="#3b95d4",t.shadowColor="#3b95d4",t.shadowBlur=15,t.font="bold 28px Comic Sans MS",t.textAlign="right",t.fillText(this.score,p-50,35),t.shadowBlur=0}},{key:"drawHealth",value:function(t){for(var e=10+this.healthW,i=0;i<this.health;i++)t.drawImage(this.healthIm,10+e*i,10,this.healthW,40)}},{key:"drawLasers",value:function(t){0!==this.lazers.length?this.lazers[this.lazers.length-1].y>=this.lazerReloadDistance&&(this.lazerLoaded=!0):this.lazerLoaded=!0;for(var e=0;e<this.lazers.length;e++){var i=this.lazers[e];i.y>-20?i.drawOneLazer(t):this.lazers.splice(e,1)}}}]),e}(),a=function(){function e(i){t(this,e),this.x=i.x+i.w/2,this.y=i.y,this.lazerSpeed=16}return i(e,[{key:"drawOneLazer",value:function(t){t.fillStyle="#ff9500",t.shadowColor="#ff9500",this.y-=this.lazerSpeed,t.fillRect(this.x,this.y,2,18),t.shadowBlur=0}}]),e}(),h=function(){function e(){t(this,e),this.reductionRatio=0,this.reductionRatio=p<u?p:u,this.alive=!0,this.speed=5*Math.random()+3,this.x=Math.floor(Math.random()*p-u/10),this.y=0-u/10,this.h=this.reductionRatio/10,this.w=this.reductionRatio/10,this.explLife=6,this.explX=0,this.explWidth=194}return i(e,[{key:"drawSprite",value:function(t,e){t.drawImage(e,this.x,this.y,this.w,this.h)}},{key:"move",value:function(){this.y+=this.speed}},{key:"drawExplosion",value:function(t,e){t.drawImage(e,this.explX,0,this.explWidth,e.height,this.x,this.y,this.w,this.h),this.explX+=this.explWidth}},{key:"resize",value:function(){this.reductionRatio=p<u?p:u,this.h=this.reductionRatio/10,this.w=this.reductionRatio/10}}]),e}(),n=function(){function e(i,s){t(this,e),this.asteroids=[],this.explAsteroids=[],this.asteroidIm=new Image,this.explIm=new Image,this.maxAsteroids=20,this.collidedAIndex=-1,this.player=new r(i,s),this.explMusic=new Audio("assets\\audio\\explosion2.mp3"),this.init()}return i(e,[{key:"init",value:function(){this.asteroidIm.src="assets\\images\\asteroid.webp",this.explIm.src="assets\\images\\spriteMapExpl.webp"}},{key:"reset",value:function(){this.asteroids=[],this.player.reset()}},{key:"drawAsteroids",value:function(t){Math.random()<=.099&&this.asteroids.length<this.maxAsteroids&&this.asteroids.push(new h);for(var e=0;e<this.asteroids.length;e++){var i=this.asteroids[e];!1!==i.alive?i.y>u+i.h?this.asteroids.splice(e,1):(i.drawSprite(t,this.asteroidIm),i.move()):(this.explAsteroids.push(i),this.asteroids.splice(e,1))}for(var s=0;s<this.explAsteroids.length;s++){var r=this.explAsteroids[s];r.explLife<=0?this.explAsteroids.splice(s,1):r.explLife>0&&(r.drawExplosion(t,this.explIm),r.explLife--)}}},{key:"resize",value:function(){this.player.resize();var t,e=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,n=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return n=t.done,t},e:function(t){o=!0,h=t},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw h}}}}(this.asteroids);try{for(e.s();!(t=e.n()).done;)t.value.resize()}catch(t){e.e(t)}finally{e.f()}}},{key:"checkCollision",value:function(t){for(var e=0;e<this.asteroids.length;e++){var i=this.asteroids[e];this.player.currentExplLife===this.player.explLife?(i.x-i.w/4*3<=this.player.x&&i.x+i.w/4*3>=this.player.x&&i.y+i.h/3>=this.player.y&&this.collidedAIndex!==this.asteroids.indexOf(i)&&(this.collidedAIndex=this.asteroids.indexOf(i),this.player.health--,this.player.currentExplLife--),this.collidedAIndex===this.asteroids.indexOf(i)&&i.y<u/2&&(this.collidedAIndex=-1)):this.player.explMusic.play();for(var s=0;s<this.player.lazers.length;s++){var r=this.player.lazers[s];r.x<=i.x+i.w&&r.x>=i.x&&r.y<=i.y&&(i.alive=!1,this.explMusic.stop(),this.explMusic.play(),this.player.score++,this.player.lazers.splice(this.player.lazers.indexOf(r),1))}}}}]),e}(),o=function(){function e(i,s){t(this,e),this.playText="",this.bgIm=new Image,this.gameStatus="start",this.backgroundHeight=0,this.bgSpeed=2,this.init()}return i(e,[{key:"init",value:function(){this.bgIm.src="assets\\images\\space.webp"}},{key:"showText",value:function(t){if(l.width=window.innerWidth,l.height=window.innerHeight,t.clearRect(0,0,p,u),t.fillStyle="#cb6e06",t.shadowColor="#392388",t.shadowBlur=25,t.textBaseline="middle","start"===this.gameStatus)this.playText="Click to start";else if("finish"===this.gameStatus){t.font="bold 90px Comic Sans MS";var e="your score: "+c.player.score;t.fillText(e,p/2-t.measureText(e).width/2,u/2+120),this.playText="GAME OVER"}t.font="bold 120px Comic Sans MS",t.fillText(this.playText,p/2-t.measureText(this.playText).width/2,u/2),t.shadowBlur=0}},{key:"drawBackground",value:function(t){this.backgroundHeight+this.bgSpeed<u?this.backgroundHeight+=this.bgSpeed:this.backgroundHeight=0;for(var e=0,i=this.backgroundHeight;e<p;){for(;i<u;)t.drawImage(this.bgIm,e,i),i+=this.bgIm.height;e+=this.bgIm.width,i=this.backgroundHeight}for(e=0,i=this.backgroundHeight-u-this.bgIm.height;e<p;){for(;i<this.backgroundHeight;)t.drawImage(this.bgIm,e,i),i+=this.bgIm.height;e+=this.bgIm.width,i=this.backgroundHeight-u-this.bgIm.height}}},{key:"gamePlay",value:function(t,e){this.drawBackground(t),e.checkCollision(t),e.drawAsteroids(t),e.player.drawLasers(t),e.player.drawSprite(t),e.player.drawScore(t),e.player.drawHealth(t),e.player.health<=0&&e.player.explLife===e.player.currentExplLife&&(this.gameStatus="finish")}}]),e}(),l=document.querySelector(".canvas");l.style.touchAction="manipulation",l.style.backgroundImage="url('assets/images/space.webp')";var d=l.getContext("2d"),p=window.innerWidth,u=window.innerHeight,c=new n(p,u),f=new o(p,u);function y(){switch(f.gameStatus){case"start":f.showText(d),c.reset(),c.resize();break;case"play":f.gamePlay(d,c);break;case"finish":f.showText(d)}window.requestAnimationFrame(y)}function w(t){switch(f.gameStatus){case"start":f.gameStatus="play";break;case"play":"right"===t&&c.player.x<=p-c.player.w?c.player.x+=c.player.speed:"left"===t&&c.player.x>0?c.player.x-=c.player.speed:!c.player.lazerLoaded||"click"!==t&&"space"!==t||(c.player.lazers.push(new a(c.player)),c.player.lazerLoaded);break;case"finish":f.gameStatus="start"}}HTMLAudioElement.prototype.stop=function(){this.pause(),this.currentTime=0},window.onload=function(){l.width=window.innerWidth,l.height=window.innerHeight,y()},window.addEventListener("resize",(function(t){l.width=t.target.innerWidth,l.height=t.target.innerHeight,p=t.target.innerWidth,u=t.target.innerHeight,c.resize()})),document.addEventListener("keydown",(function(t){"ArrowRight"===t.key?w("right"):"ArrowLeft"===t.key&&w("left")}),!0),document.addEventListener("keyup",(function(t){" "===t.key&&w("space")}),!0),l.onmousemove=function(t){c.player.x=t.clientX-c.player.w/2},l.onmousedown=function(t){w("click")},l.addEventListener("touchstart",(function(t){t.stopPropagation(),t.preventDefault(),w("click")})),l.addEventListener("touchmove",(function(t){if(t.stopPropagation(),t.preventDefault(),1===t.targetTouches.length){var e=t.targetTouches[0];c.player.x=e.pageX-c.player.w/2}}))})();
